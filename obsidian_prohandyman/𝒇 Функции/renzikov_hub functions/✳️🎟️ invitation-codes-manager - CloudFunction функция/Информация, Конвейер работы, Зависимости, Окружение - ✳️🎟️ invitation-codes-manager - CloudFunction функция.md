
–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä - [–ë–£–î–ï–¢_–°–û–ó–î–ê–ù]
–û–ø–∏—Å–∞–Ω–∏–µ - üéüÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞–º–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –Ω–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Ñ–∏—Ä–º–∞–º
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - index.handler
–¢–∞–π–º–∞—É—Ç - 20 —Å–µ–∫

---

–ù–∞ –≤—Ö–æ–¥–µ:
	-> `Authorization: Bearer <jwt_token>`: JWT —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ auth-gate –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –¥–µ–π—Å—Ç–≤–∏–π)
	-> `user_id` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT
	-> `action` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**): –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏
	-> –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç action

–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–±–æ—Ç–∞:
	-> –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è `user_id` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä–∞ API Gateway
	-> –ü–æ–ª—É—á–µ–Ω–∏–µ `action` –∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ API Gateway
	-> –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ –¥–µ–π—Å—Ç–≤–∏—è–º:
		-> **CREATE_CODE**: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (—Ç—Ä–µ–±—É–µ—Ç OWNER/ADMIN)
		-> **DELETE_CODE**: –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–¥–∞ (—Ç—Ä–µ–±—É–µ—Ç OWNER/ADMIN)
		-> **GET_CODES**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–æ–¥–æ–≤ —Ñ–∏—Ä–º—ã (—Ç—Ä–µ–±—É–µ—Ç OWNER/ADMIN)
		-> **GET_INSTANT_CODE**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∫–æ–¥–∞ (—Ç—Ä–µ–±—É–µ—Ç OWNER/ADMIN)
		-> **JOIN_REQUEST**: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ –∫–æ–¥—É
		-> **GET_REQUESTS**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç OWNER/ADMIN)
		-> **APPROVE_REQUEST**: –û–¥–æ–±—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (—Ç—Ä–µ–±—É–µ—Ç OWNER/ADMIN)
		-> **REJECT_REQUEST**: –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (—Ç—Ä–µ–±—É–µ—Ç OWNER/ADMIN)

–ù–∞ –≤—ã—Ö–æ–¥–µ:
	-> `200 OK` / `201 Created`: –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
	-> `400 Bad Request`: –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
	-> `403 Forbidden`: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
	-> `404 Not Found`: –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
	-> `500 Internal Server Error`: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞

---
#### –î–µ–π—Å—Ç–≤–∏—è

### CREATE_CODE
–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥–ª—è —Ñ–∏—Ä–º—ã.

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `firm_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): ID —Ñ–∏—Ä–º—ã
- `max_usage_count` (integer, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -1): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π
- `expires_in_hours` (integer, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 168): –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –≤ —á–∞—Å–∞—Ö
- `is_instant` (boolean, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false): –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- `object_id` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): ID –æ–±—ä–µ–∫—Ç–∞ —Å—Ç—Ä–æ–π–∫–∏
- `metadata_json` (object, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–í—ã—Ö–æ–¥:**
```json
{
  "code_id": "...",
  "code_value": "ABC12345",
  "expires_at": "2024-01-01T00:00:00Z"
}
```

### DELETE_CODE
–î–µ–∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è.

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `firm_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `code_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

**–í—ã—Ö–æ–¥:**
```json
{
  "message": "Code deleted successfully"
}
```

### GET_CODES
–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤ —Ñ–∏—Ä–º—ã.

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `firm_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `include_inactive` (boolean, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false)

**–í—ã—Ö–æ–¥:**
```json
{
  "codes": [
    {
      "code_id": "...",
      "code_value": "ABC12345",
      "created_at": "...",
      "expires_at": "...",
      "max_usage_count": 10,
      "current_usage": 3,
      "is_active": true,
      "is_instant": false
    }
  ]
}
```

### GET_INSTANT_CODE
–ü–æ–ª—É—á–∞–µ—Ç –∏–ª–∏ —Å–æ–∑–¥–∞—ë—Ç –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–π –∫–æ–¥ (10 –º–∏–Ω—É—Ç).

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `firm_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

**–í—ã—Ö–æ–¥:**
```json
{
  "code_value": "INST9876",
  "expires_at": "2024-01-01T00:10:00Z"
}
```

### JOIN_REQUEST
–°–æ–∑–¥–∞—ë—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ –∫–æ–¥—É.

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `code_value` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): –ó–Ω–∞—á–µ–Ω–∏–µ –∫–æ–¥–∞
- `dispatcher_id` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): ID –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞

**–í—ã—Ö–æ–¥ –¥–ª—è –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞:**
```json
{
  "message": "Successfully joined the firm",
  "firm_id": "..."
}
```

**–í—ã—Ö–æ–¥ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –∫–æ–¥–∞:**
```json
{
  "message": "Join request created",
  "request_id": "...",
  "firm_id": "..."
}
```

### GET_REQUESTS
–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `firm_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `code_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `status` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): PENDING, APPROVED, REJECTED

**–í—ã—Ö–æ–¥:**
```json
{
  "requests": [
    {
      "request_id": "...",
      "user_id": "...",
      "requested_at": "...",
      "status": "PENDING",
      "likes_count_at_request": 0,
      "dislikes_count_at_request": 0,
      "blocks_count_at_request": 0
    }
  ]
}
```

### APPROVE_REQUEST
–û–¥–æ–±—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ñ–∏—Ä–º—É.

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `firm_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `request_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `code_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

**–í—ã—Ö–æ–¥:**
```json
{
  "message": "Request approved successfully"
}
```

### REJECT_REQUEST
–û—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `firm_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `request_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `code_id` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `rejection_reason` (string, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í—ã—Ö–æ–¥:**
```json
{
  "message": "Request rejected successfully"
}
```

---
#### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã:**
- `utils/*` (–æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã)
- `utils/util_ydb/driver.py` - get_session_pool –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ YDB
- `utils/util_ydb/credentials.py` - ydb_creds_from_env –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è credentials –∏–∑ ENV

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:**
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é auth-gate –Ω–∞ —É—Ä–æ–≤–Ω–µ API Gateway

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- `SA_KEY_JSON` - JSON –∫–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ YDB
- `YDB_ENDPOINT_INVITATIONS` - –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è invitations-database
- `YDB_DATABASE_INVITATIONS` - –ü—É—Ç—å –∫ invitations-database
- `YDB_ENDPOINT_FIRMS` - –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è firms-database
- `YDB_DATABASE_FIRMS` - –ü—É—Ç—å –∫ firms-database
