–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä - [–ë–£–î–ï–¢_–°–û–ó–î–ê–ù]
–û–ø–∏—Å–∞–Ω–∏–µ - üß© –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ñ—É–Ω–∫—Ü–∏—è-–º–µ–Ω–µ–¥–∂–µ—Ä: –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç metadata_json –ø–æ JSON-—Å—Ö–µ–º–µ –∏ –æ–±–æ–≥–∞—â–∞–µ—Ç –µ—ë –¥–∞–Ω–Ω—ã–º–∏ –æ —Å—Ö–µ–º–µ.
–¢–∞–π–º–∞—É—Ç - 5 —Å–µ–∫

---
### –ö–æ–Ω–≤–µ–π–µ—Ä —Ä–∞–±–æ—Ç—ã
–ù–∞ –≤—Ö–æ–¥–µ:
	-> `schema_name` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**) ‚Äî –∏–º—è —Å—Ö–µ–º—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä `invitation_code_metadata`).
	-> `entity_type` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**) ‚Äî —Ç–∏–ø —Å—É—â–Ω–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä `invitation_code`).
	-> `metadata` (object, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**) ‚Äî JSON, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å.

–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–±–æ—Ç–∞:
	-> –ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ `utils.parse_event`, –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ `body_dict`.
	-> –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–æ–ª–µ–π (—Ç–∏–ø/–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å), —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ 400.
	-> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ YDB (`YDB_ENDPOINT_META`/`YDB_DATABASE_META` –ª–∏–±–æ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ `YDB_ENDPOINT`/`YDB_DATABASE`), —Å–æ–∑–¥–∞–Ω–∏–µ –ø—É–ª–∞ `get_session_pool`.
	-> –í —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`session.transaction(ydb.SerializableReadWrite())`):
		-> –ß—Ç–µ–Ω–∏–µ *–ø–æ—Å–ª–µ–¥–Ω–µ–π* —Å—Ö–µ–º—ã –∏–∑ `schema_registry` –ø–æ (`schema_name`, `entity_type`).
		-> –ü–∞—Ä—Å–∏–Ω–≥ `json_schema` —á–µ—Ä–µ–∑ `loads_safe`.
        -> –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è `metadata` (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è `type`, `required`, `properties`, `items`, `additionalProperties=false`).
		-> –û–±–æ–≥–∞—â–µ–Ω–∏–µ `metadata`: –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—è `__schema_name`, `__schema_version`.
		-> –ö–æ–º–º–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –≤–æ–∑–≤—Ä–∞—Ç –≤–µ—Ä—Å–∏–∏ —Å—Ö–µ–º—ã.
	-> –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ 400 (—Å –¥–µ—Ç–∞–ª—è–º–∏ –ø–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏) –∏–ª–∏ 500 (–∏—Å–∫–ª—é—á–µ–Ω–∏—è).

–ù–∞ –≤—ã—Ö–æ–¥–µ:
	-> `200 OK`: `{ "valid": true, "schema_name": <str>, "schema_version": <int>, "metadata": {...} }`.
	-> `400 Bad Request`: `{ "message": "...", "errors"?: [ ... ] }` ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–π –≤—Ö–æ–¥ –∏–ª–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º–µ.
	-> `500 Internal Server Error`: –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–±–ª–µ–º—ã —Å –ë–î –∏–ª–∏ –∏—Å–ø–æ—Ä—á–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞).

---
- **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã**: `parse_event`, `ok`, `server_error`, `json_response`, `loads_safe`, `JsonLogger`, `get_session_pool`, `ydb_creds_from_env`, `invoke_function`.
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
    - `YDB_ENDPOINT_META`, `YDB_DATABASE_META` ‚Äî –ë–î —Å —Ç–∞–±–ª–∏—Ü–µ–π `schema_registry` (–µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `YDB_ENDPOINT`, `YDB_DATABASE`).
    - (–æ–ø—Ü.) `FN_METADATA_VALIDATOR` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤ —á–µ—Ä–µ–∑ `invoke_function`.

---
#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—ã–∑–æ–≤** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ):
    -> –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å payload, –≤—ã–∑–≤–∞—Ç—å —á–µ—Ä–µ–∑ `utils.invoke_function(...)` –∏–∑ –¥—Ä—É–≥–æ–π CloudFunction.
- **–ß–µ—Ä–µ–∑ API Gateway** (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è):
    -> –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å POST –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–º –∂–µ —Ç–µ–ª–æ–º.
    -> –û—Ç–≤–µ—Ç—ã/–∫–æ–¥—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã –æ–ø–∏—Å–∞–Ω–Ω—ã–º –≤—ã—à–µ.

- **–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–æ –≤–Ω–µ—à–Ω–µ–º —Å–µ—Ä–≤–∏—Å–µ**:

```python
import os

from utils import invoke_function

payload = {
    "schema_name": "invitation_code_metadata",
    "entity_type": "invitation_code",
    "metadata": {"foo": "bar"},
}

response = invoke_function(
    target=f"https://functions.yandexcloud.net/{os.environ['FN_METADATA_VALIDATOR']}",
    json_payload=payload,
    allow_hosts=("functions.yandexcloud.net",),
    parse_json=True,
)
# response["json"] -> { "valid": true/false, ... }
```

---
#### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –ø–æ–¥–Ω–∞–±–æ—Ä JSON Schema (`type`, `required`, `properties`, `items`).
- –§–æ—Ä–º–∞—Ç—ã, `enum`, `pattern`, –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ –∏ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è.
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è `additionalProperties: false`.
