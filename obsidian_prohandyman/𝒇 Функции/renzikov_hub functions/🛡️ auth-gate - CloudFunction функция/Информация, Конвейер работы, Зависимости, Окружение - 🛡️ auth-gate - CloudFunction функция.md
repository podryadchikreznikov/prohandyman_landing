–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä - d4eko30p260oae7m3rfa
–û–ø–∏—Å–∞–Ω–∏–µ - üõ°Ô∏è –§—É–Ω–∫—Ü–∏—è-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä (–≥–µ–π—Ç) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö API.
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - index.handler
–¢–∞–π–º–∞—É—Ç - 5 —Å–µ–∫

---
### –ö–æ–Ω–≤–µ–π–µ—Ä —Ä–∞–±–æ—Ç—ã

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∞–º–∏–º API Gateway **–ø–µ—Ä–µ–¥** —Ç–µ–º, –∫–∞–∫ –ø–µ—Ä–µ–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `edit-task` –∏–ª–∏ `get-user-data`).

–ù–∞ –≤—Ö–æ–¥–µ:
	-> `event`: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å–æ–±—ã—Ç–∏—è –æ—Ç API Gateway, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ (`headers`).

–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–±–æ—Ç–∞:
	-> **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞**:
		-> –§—É–Ω–∫—Ü–∏—è –∏—â–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization` –≤ `event['headers']`.
		-> –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞ `Bearer `.
		-> –ï—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—Ç–≤–µ—Ç –æ –Ω–µ—É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
	-> **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è JWT**:
		-> –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —É—Ç–∏–ª–∏—Ç—É `utils.util_crypto.jwt_tokens.verify_jwt()`.
		-> –£—Ç–∏–ª–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `JWT_SECRET` –∏ **—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞** (`verify_exp=True`).
		-> –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω (–Ω–µ–≤–µ—Ä–Ω–∞—è –ø–æ–¥–ø–∏—Å—å, –∏—Å—Ç–µ–∫—à–∏–π —Å—Ä–æ–∫, –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç), –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—Ç–≤–µ—Ç –æ –Ω–µ—É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
	-> **üîí STATEFUL –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**:
		-> –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ JWT —Ñ—É–Ω–∫—Ü–∏—è **—Å–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö `jwt-database`**.
		-> –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è `jwt_token` –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ `user_id` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`.
		-> –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –≤ –ë–î –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –¥–æ—Å—Ç—É–ø **–∑–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è**.
		-> –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é —Å—Ç–∞—Ä—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –ø–∞—Ä–æ–ª—è –∏–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞.
	-> **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è API Gateway**:
		-> **–ü—Ä–∏ —É—Å–ø–µ—Ö–µ**:
			-> –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π JSON-–æ—Ç–≤–µ—Ç: `{"isAuthorized": true, "context": {...}}`.
			-> –í –ø–æ–ª–µ `context` –ø–æ–º–µ—â–∞–µ—Ç—Å—è `user_payload` (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–æ–∫–µ–Ω–∞: `user_id`, `email`), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –æ—Å–Ω–æ–≤–Ω–æ–π (—Ü–µ–ª–µ–≤–æ–π) —Ñ—É–Ω–∫—Ü–∏–∏. –≠—Ç–æ –∏–∑–±–∞–≤–ª—è–µ—Ç —Ü–µ–ª–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω.
		-> **–ü—Ä–∏ –æ—à–∏–±–∫–µ**:
			-> –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç `{"isAuthorized": false}`.
			-> API Gateway, –ø–æ–ª—É—á–∏–≤ —Ç–∞–∫–æ–π –æ—Ç–≤–µ—Ç, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω–µ—Ç –∫–ª–∏–µ–Ω—Ç—É –æ—à–∏–±–∫—É `403 Forbidden`.

–ù–∞ –≤—ã—Ö–æ–¥–µ:
	-> **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π JSON-–æ—Ç–≤–µ—Ç –¥–ª—è API Gateway**:
		-> `{"isAuthorized": true, "context": {"user_payload": "{\"user_id\": \"...\", \"email\": \"...\"}"}}` –≤ —Å–ª—É—á–∞–µ —É—Å–ø–µ—Ö–∞.
		-> `{"isAuthorized": false}` –≤ —Å–ª—É—á–∞–µ –ª—é–±–æ–π –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

---
### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

- **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã**: 
    - `utils/util_log/logger.py` - JsonLogger –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    - `utils/util_json/` - loads_safe, dumps_compact –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å JSON
    - `utils/util_errors/exceptions.py` - Unauthorized –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
    - `utils/util_crypto/jwt_tokens.py` - verify_jwt –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤
    - `utils/util_ydb/driver.py` - get_session_pool –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ YDB
    - `utils/util_ydb/credentials.py` - ydb_creds_from_env –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è credentials –∏–∑ ENV
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
    - `SA_KEY_JSON` - JSON –∫–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ YDB
    - `JWT_SECRET` - –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤
    - `YDB_ENDPOINT` - –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è `jwt-database` (–¥–ª—è stateful –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤)
    - `YDB_DATABASE` - –ü—É—Ç—å –∫ `jwt-database` (–¥–ª—è stateful –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤)
    - `YDB_ENDPOINT_FIRMS` - –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è `firms-database` (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π)
    - `YDB_DATABASE_FIRMS` - –ü—É—Ç—å –∫ `firms-database` (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–µ–π)