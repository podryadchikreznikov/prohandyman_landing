
–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä - d4e6pc9kpgijmt3ii2v9
–û–ø–∏—Å–∞–Ω–∏–µ - üîî –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥**: Web Push —á–µ—Ä–µ–∑ Yandex CNS, RuStore Push - –Ω–∞–ø—Ä—è–º—É—é.
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - index.handler
–¢–∞–π–º–∞—É—Ç - 20 —Å–µ–∫

---

–ù–∞ –≤—Ö–æ–¥–µ:
	-> `Authorization: Bearer <jwt_token>` (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ API Gateway —á–µ—Ä–µ–∑ auth-gate –¥–ª—è ADD, DELETE, GET_LIST)
	-> `action` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**): `ADD`, `DELETE`, `GET_LIST`, `SEND`.
	-> `user_id` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä–æ–º auth-gate (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π).
	-> **–î–ª—è `ADD`**:
		- `push_token` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**): JSON-—Å—Ç—Ä–æ–∫–∞ –¥–ª—è Web –∏–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è RuStore.
		- `device_info` (object, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
	-> **–î–ª—è `DELETE`**:
		- `push_token` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**): –¢–æ–∫–µ–Ω –ø–æ–¥–ø–∏—Å–∫–∏, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å. **–ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞.**
	-> **–î–ª—è `SEND`**:
		- `user_id_to_notify` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**): ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏.
		- `payload` (object, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**): `{"title": "...", "body": "..."}`.

–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–±–æ—Ç–∞:
    -> –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
    -> –ü–æ–ª—É—á–µ–Ω–∏–µ 'action' –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ API Gateway –∏–ª–∏ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞.
    -> –ü–∞—Ä—Å–∏–Ω–≥ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞.
    -> –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:
        -> –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π (ADD, DELETE, GET_LIST): `user_id` –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä–∞ API Gateway (`requestContext.authorizer.user_payload`). JWT –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —Ñ—É–Ω–∫—Ü–∏–µ–π [[üõ°Ô∏è auth-gate - CloudFunction —Ñ—É–Ω–∫—Ü–∏—è]] –¥–æ –≤—ã–∑–æ–≤–∞ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
        -> –î–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è SEND: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, user_id –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞.
    -> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥—Ä–∞–π–≤–µ—Ä–∞ –∏ –ø—É–ª–∞ —Å–µ—Å—Å–∏–π YDB –¥–ª—è –±–∞–∑—ã endpoints.
    -> –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ 'action':
        -> **ADD** (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):
            -> –ü–æ–ª—É—á–µ–Ω–∏–µ push_token –∏ device_info.
            -> –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã (WEB –∏–ª–∏ RUSTORE) –ø–æ —Ñ–æ—Ä–º–∞—Ç—É —Ç–æ–∫–µ–Ω–∞.
            -> –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö—ç—à–∞ —Ç–æ–∫–µ–Ω–∞.
            -> –ï—Å–ª–∏ WEB: –°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è endpoint –≤ Yandex CNS, –ø–æ–ª—É—á–µ–Ω–∏–µ endpoint_arn.
            -> UPSERT –∑–∞–ø–∏—Å–∏ –≤ UserEndpoints —Å –¥–∞–Ω–Ω—ã–º–∏ (—Ö—ç—à, user_id, –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, —Ç–æ–∫–µ–Ω, ARN –µ—Å–ª–∏ WEB, enabled=true, device_info, timestamps).
        -> **DELETE** (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):
            -> –ü–æ–ª—É—á–µ–Ω–∏–µ push_token.
            -> –í—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ö—ç—à–∞ –∏ –ø–æ–∏—Å–∫ –∑–∞–ø–∏—Å–∏ –≤ UserEndpoints.
            -> –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ user_id —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–∏–º.
            -> –ï—Å–ª–∏ WEB –∏ –µ—Å—Ç—å ARN: –£–¥–∞–ª–µ–Ω–∏–µ endpoint –∏–∑ CNS (–∏–≥–Ω–æ—Ä–∏—Ä—É—è NotFound).
            -> –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ UserEndpoints.
        -> **GET_LIST** (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):
            -> –ó–∞–ø—Ä–æ—Å –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π –¥–ª—è user_id –∏–∑ UserEndpoints (—Å –∏–Ω–¥–µ–∫—Å–æ–º).
            -> –ü–∞—Ä—Å–∏–Ω–≥ device_info_json –∏ –≤–æ–∑–≤—Ä–∞—Ç —Å–ø–∏—Å–∫–∞ –≤ JSON.
        -> **SEND** (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤):
            -> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥—Ä–∞–π–≤–µ—Ä–∞ –∏ –ø—É–ª–∞ –¥–ª—è –±–∞–∑—ã notices.
            -> –ü–æ–ª—É—á–µ–Ω–∏–µ user_id_to_notify –∏ payload (title, body).
            -> –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã notices_{user_id} –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (—Å –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º–æ–π).
            -> UPSERT —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ notices_{user_id} (notice_id, title, provider='–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', additional_info_json —Å body, created_at, is_delivered=false).
            -> –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ (is_enabled=true) –¥–ª—è user_id.
            -> –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–ø–∏—Å–∫–∏:
                -> –ï—Å–ª–∏ WEB: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ payload –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –≤ CNS —á–µ—Ä–µ–∑ endpoint_arn.
                -> –ï—Å–ª–∏ RUSTORE: –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ rustore_push_utils.
                -> –°–±–æ—Ä –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ (EndpointDisabled –∏–ª–∏ UNREGISTERED).
            -> –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ: –ü–∞–∫–µ—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UserEndpoints, —É—Å—Ç–∞–Ω–æ–≤–∫–∞ is_enabled=false –¥–ª—è –∏—Ö —Ö—ç—à–µ–π.
    -> –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π: AuthError (403), LogicError (400), NotFoundError (404), –¥—Ä—É–≥–∏–µ (500).

–ù–∞ –≤—ã—Ö–æ–¥–µ:
    -> 201 Created –¥–ª—è ADD —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º —É—Å–ø–µ—Ö–∞.
    -> 200 OK –¥–ª—è DELETE, GET_LIST (—Å –¥–∞–Ω–Ω—ã–º–∏), SEND (—Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö).
    -> 400 Bad Request –¥–ª—è –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤).
    -> 403 Forbidden –¥–ª—è –æ—à–∏–±–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
    -> 404 Not Found –µ—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.
    -> 500 Internal Server Error –¥–ª—è –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫.

---
#### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
-   **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã**: `utils/ydb_utils.py`, `utils/request_parser.py`, `utils/rustore_push_utils.py`, `utils/util_yc_sa/*`
-   **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é [[üõ°Ô∏è auth-gate - CloudFunction —Ñ—É–Ω–∫—Ü–∏—è]] –Ω–∞ —É—Ä–æ–≤–Ω–µ API Gateway (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π)
-   **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
    -   `YDB_ENDPOINT_ENDPOINTS`, `YDB_DATABASE_ENDPOINTS`
    -   `YDB_ENDPOINT_NOTICES`, `YDB_DATABASE_NOTICES`
    -   `YC_LOCKBOX_SECRET_ID` - secret_id Lockbox —Å authorized key JSON
    -   `YC_LOCKBOX_VERSION_ID` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤–µ—Ä—Å–∏—è —Å–µ–∫—Ä–µ—Ç–∞
    -   `YC_LOCKBOX_KEY_FIELD` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∏–º—è –ø–æ–ª—è –≤ —Å–µ–∫—Ä–µ—Ç–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é key.json)
    -   `CNS_PLATFORM_APP_ARN_WEB`: ARN **—Ç–æ–ª—å–∫–æ** –¥–ª—è Web Push-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Yandex Notification Service.
    -   `RUSTORE_PROJECT_ID`: ID –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ RuStore.
    -   `RUSTORE_SERVICE_TOKEN`: –°–µ—Ä–≤–∏—Å–Ω—ã–π —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ RuStore.
    -   `CNS_REGION`: –†–µ–≥–∏–æ–Ω, –≤ –∫–æ—Ç–æ—Ä–æ–º —Å–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–∏—Å (`ru-central1`).
    -   `CNS_ENDPOINT_URL`: URL —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ Yandex Notification Service (`https://notifications.yandexcloud.net`).
    -   `STATIC_ACCESS_KEY_ID`
    -   `STATIC_SECRET_ACCESS_KEY`
