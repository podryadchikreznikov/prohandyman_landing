
–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä - d4e32tlus7fal6gs96iv
–û–ø–∏—Å–∞–Ω–∏–µ - üîë –£–ø—Ä–∞–≤–ª—è–µ—Ç —Å–±—Ä–æ—Å–æ–º –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ email.
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - index.handler
–¢–∞–π–º–∞—É—Ç - 15 —Å–µ–∫

---
### –ö–æ–Ω–≤–µ–π–µ—Ä —Ä–∞–±–æ—Ç—ã

–ù–∞ –≤—Ö–æ–¥–µ:
    -> –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:
        - `action` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**): `REQUEST_RESET`, `RESET`.
        - `email` (string, **–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –µ—Å–ª–∏ –Ω–µ—Ç phone_number**): Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        - `phone_number` (string, **–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –µ—Å–ª–∏ –Ω–µ—Ç email**): –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        - `new_password` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è `RESET`**): –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å.
        - `current_password_hash` (string, **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è `RESET`**): –•–µ—à —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è –∏–∑ email.

–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–±–æ—Ç–∞:
    -> **–ü–∞—Ä—Å–∏–Ω–≥ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è `action` –∏ `email`.
    -> **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –¥—Ä–∞–π–≤–µ—Ä YDB –¥–ª—è `jwt-database`.
    -> **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ `action`**:
        -> **`REQUEST_RESET`**:
            -> –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç phone_number –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω.
            -> –í `jwt-database` –∏—â–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ `email` –∏–ª–∏ `phone_number`.
            -> –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –æ—à–∏–±–∫–∞ 404.
            -> –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è `password_hash`.
            -> –° –ø–æ–º–æ—â—å—é `password_manager_email` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–∏—Å—å–º–æ —Å —Ö–µ—à–µ–º (–µ—Å–ª–∏ –µ—Å—Ç—å email).
            -> –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 200 OK.
        -> **`RESET`**:
            -> –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ `new_password` –∏ `current_password_hash`.
            -> –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç phone_number –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω.
            -> –í `jwt-database` –∏—â–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ `email` –∏–ª–∏ `phone_number`.
            -> –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –æ—à–∏–±–∫–∞ 404.
            -> –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è `current_password_hash` –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ —Å `password_hash` –∏–∑ –ë–î. –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç, –æ—à–∏–±–∫–∞ 401.
            -> `new_password` —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `utils.auth_utils.hash_password`.
            -> –í `jwt-database` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–µ `password_hash`.
            -> **–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –Ω–æ–≤—ã–π JWT —Ç–æ–∫–µ–Ω —Å email –∏/–∏–ª–∏ phone_number –≤ claims.**
            -> –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 200 OK —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º.
    -> **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π**: –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –æ—à–∏–±–∫–∏, –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã.

–ù–∞ –≤—ã—Ö–æ–¥–µ:
    -> `200 OK` (–¥–ª—è `REQUEST_RESET`): `{"message": "Password reset instructions have been sent to your email."}`
    -> `200 OK` (–¥–ª—è `RESET`): **`{"token": "<jwt_token>"}`**
    -> `400 Bad Request`: –ù–µ–≤–µ—Ä–Ω—ã–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.
    -> `401 Unauthorized`: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π —Ö–µ—à —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ä–æ–ª—è.
    -> `404 Not Found`: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º email –Ω–µ –Ω–∞–π–¥–µ–Ω.
    -> `500 Internal Server Error`: –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

---
#### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- **–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã**:
    - `utils/auth_utils.py` [[üìÑ utils - auth_utils.md]]
    - `utils/ydb_utils.py` [[üìÑ utils - ydb_utils.md]]
    - `utils/request_parser.py` [[üìÑ utils - request_parser.md]]
    - `utils/util_yc_sa/*`
    - `password_manager_email.py` (–ª–æ–∫–∞–ª—å–Ω—ã–π –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏)
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
	- `YDB_ENDPOINT`, `YDB_DATABASE` ([[üíæ jwt-database - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö YandexDatabase.md]])
	- `YC_LOCKBOX_SECRET_ID` - secret_id Lockbox —Å authorized key JSON
	- `YC_LOCKBOX_VERSION_ID` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤–µ—Ä—Å–∏—è —Å–µ–∫—Ä–µ—Ç–∞
	- `YC_LOCKBOX_KEY_FIELD` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∏–º—è –ø–æ–ª—è –≤ —Å–µ–∫—Ä–µ—Ç–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é key.json)
	- `JWT_SECRET`
    - `UNISENDER_API_KEY`, `UNISENDER_SENDER_EMAIL`, `UNISENDER_SENDER_NAME`, `UNISENDER_LIST_ID` (–¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ email)
