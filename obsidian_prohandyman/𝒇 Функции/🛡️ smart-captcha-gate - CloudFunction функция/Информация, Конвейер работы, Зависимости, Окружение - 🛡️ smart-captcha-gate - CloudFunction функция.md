–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä - d4eb2tnhvgfiarjhofi7
–ò–º—è - smart-captcha-gate
–û–ø–∏—Å–∞–Ω–∏–µ - üõ°Ô∏è –§—É–Ω–∫—Ü–∏—è-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ç–æ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞ Yandex SmartCaptcha –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ API.
–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - index.handler
–¢–∞–π–º–∞—É—Ç - 5 —Å–µ–∫

---
### –ö–æ–Ω–≤–µ–π–µ—Ä —Ä–∞–±–æ—Ç—ã

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è API Gateway –∫–∞–∫ function-authorizer –ø–µ—Ä–µ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π.

–ù–∞ –≤—Ö–æ–¥–µ:
	-> `event.headers`: –∏—â–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –∫–∞–ø—á–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö `SmartCaptcha-Token` –∏–ª–∏ `X-Captcha-Token`.
	-> —Ä–µ–∑–µ—Ä–≤–Ω–æ –≤ `body` (JSON): –ø–æ–ª–µ `captcha_token`.
	-> IP –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ `event.requestContext.identity.sourceIp` –∏–ª–∏ `event.requestContext.http.sourceIp`.

–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–±–æ—Ç–∞:
	-> –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–∑–∞–≥–æ–ª–æ–≤–∫–∏ ‚Üí —Ç–µ–ª–æ).
	-> –í—ã–∑–æ–≤ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ SmartCaptcha:
		GET `https://smartcaptcha.yandexcloud.net/validate?secret=<SERVER_KEY>&token=<TOKEN>&ip=<IP>`
	-> –ê–Ω–∞–ª–∏–∑ –æ—Ç–≤–µ—Ç–∞: `{ "status": "ok" }` ‚Äî —É—Å–ø–µ—Ö, –∏–Ω–∞—á–µ ‚Äî –æ—Ç–∫–∞–∑.
	-> –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü-–æ—Ç–≤–µ—Ç–∞ –¥–ª—è API Gateway: `{"isAuthorized": true/false, "context": {"captcha": "ok"}}`.

–ù–∞ –≤—ã—Ö–æ–¥–µ:
	-> `{"isAuthorized": true, "context": {"captcha": "ok"}}` ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Ü–µ–ª–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
	-> `{"isAuthorized": false}` ‚Äî API Gateway –≤–µ—Ä–Ω–µ—Ç 403 Forbidden.

---
### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

- –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —É—Ç–∏–ª–∏—Ç—ã:
	- `utils/util_log/logger.py` ‚Äî JsonLogger –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
	- `utils/util_json/` ‚Äî loads_safe –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
	- `SMARTCAPTCHA_SERVER_KEY` ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –∫–ª—é—á SmartCaptcha (–∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "üß© Yandex SmartCaptcha")

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- –¢–æ–∫–µ–Ω —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `SmartCaptcha-Token`.
- IP –º–æ–∂–Ω–æ –æ–ø—É—Å–∫–∞—Ç—å ‚Äî SmartCaptcha –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ –∏ –±–µ–∑ –Ω–µ–≥–æ, –Ω–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `sourceIp` –æ–Ω –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω.
