---
Идентификатор - [БУДЕТ_СОЗДАН]
Путь к базе - [используется YDB_DATABASE_META или YDB_DATABASE]
Эндпоинт - [используется YDB_ENDPOINT_META или YDB_ENDPOINT]

---
# Таблицы

#### Таблица: `schema_registry`

| # | Имя              | Ключ                         | Тип        | Описание                                                                  |
| - | ---------------- | ---------------------------- | ---------- | ------------------------------------------------------------------------- |
| 0 | `schema_name`    | PK (часть 1)                 | `Utf8`     | Имя схемы (например `invitation_code_metadata`).                           |
| 1 | `entity_type`    | PK (часть 2)                 | `Utf8`     | Тип сущности/события.                                                     |
| 2 | `schema_version` | PK (часть 3)                 | `Int32`    | Версия схемы.                                                              |
| 3 | `json_schema`    |                              | `Json`     | JSON-схема (поддерживает `type`, `required`, `properties`, `items`).       |
| 4 | `created_at`     |                              | `Timestamp`| Время регистрации версии схемы.                                           |

#### Таблица: `aggregate_state`

| # | Имя           | Ключ             | Тип        | Описание                                                               |
| - | ------------- | ---------------- | ---------- | ---------------------------------------------------------------------- |
| 0 | `entity_type` | PK (часть 1)     | `Utf8`     | Тип сущности/агрегата.                                                 |
| 1 | `uuid`        | PK (часть 2)     | `Utf8`     | Идентификатор агрегата (смены, сделки, события).                       |
| 2 | `last_seq_no` |                  | `Utf8`     | Последний подтверждённый порядковый номер (строка для поддержки больших чисел и ведущих нулей). |
| 3 | `updated_at`  |                  | `Timestamp`| Время обновления записи.                                               |

---
#### YQL для управления таблицей

**YQL для создания таблицы:**
```yql
CREATE TABLE `aggregate_state` (
    entity_type Utf8,
    uuid Utf8,
    last_seq_no Utf8,
    updated_at Timestamp,
    PRIMARY KEY (entity_type, uuid)
);
```

---
# Примечания
- Таблицы используются CloudFunction `metadata-validator` для загрузки JSON-схем и контроля дубликатов.
- При отсутствии `YDB_ENDPOINT_META` / `YDB_DATABASE_META` используется основная пара `YDB_ENDPOINT` / `YDB_DATABASE`.
